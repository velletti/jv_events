<f:layout name="Default" />

<f:section name="content">
<f:flashMessages />
	<script type="application/javascript">
        $(document).ready(function() {
            $('.tx_jvevents_citrix').click( function(event) {
                event.preventDefault() ;
                var thisReg = $(this)
				$(thisReg).html( $('#jvevents-spinner-icon').html() )  ;

                $.get( $(this).attr("href") , function(data , status ) {
					$(thisReg).html($('#jvevents-close-icon').html());
					if (data.uid) {
						if (data.text.status) {
							$('.registrant' + data.uid + ' .tx_jvevents_citrix').html(
                                $(thisReg).html( $('#jvevents-okay-icon').html() + data.text.status )
							);
						}
					} else {
						$(thisReg).html($('#jvevents-error-icon').html());
					}
				}) ;
            }) ;

		}) ;

	</script>
	<div class="hide">
		<!-- comment: Icon or messages needed for Ajax see typo3\sysext\core\Classes\Imaging\IconRegistry.php //-->


		<span id="jvevents-spinner-icon"><core:icon identifier="spinner-circle-dark"/></span>
		<span id="jvevents-close-icon"><core:icon identifier="status-dialog-notification"/></span>
		<span id="jvevents-error-icon"><core:icon identifier="status-dialog-error"/></span>
		<span id="jvevents-okay-icon"><core:icon identifier="status-dialog-ok"/></span>
	</div>


<h2><f:count>{registrants}</f:count> Registrations</h2>
	<f:if condition="events">
		<f:if condition="{settings.directmail}">
			<div>
					<f:link.action class="btn btn-default" action="list" arguments="{createDmailGroup:1}" title="Create Email Group">
						<core:icon identifier="actions-document"/> Create Email lists for Newsletter
					</f:link.action>


			</div>
		</f:if>
		<f:form id="jveventFilterForm" action="list" controller="EventBackend" method="post">
			<input type="hidden" name="uid" value="{plugin.uid}" /><f:form.hidden name="pluginUid" value="{plugin.uid}" />
			<f:form.select name="event" value="{event}" additionalAttributes="{onchange: 'document.getElementById(\'jveventFilterForm\').submit();'}" id="jvevents" property="event" options="{events}" optionLabelField="name" sortByOptionLabel="TRUE" prependOptionLabel="-" prependOptionValue="0"></f:form.select>
		</f:form>

	</f:if>
	<f:be.widget.paginate objects="{registrants}" as="paginatedRegistrants" configuration="{itemsPerPage: itemsPerPage, insertAbove: 1, maximumNumberOfLinks: 3}">
		<div class="row bg-primary ">
			<div class="col-xs-1">

			</div>
			<div class="col-xs-4">
				<b>Vor- Nachname</b>
			</div>
			<div class="col-xs-4">
				<b>E-Mail</b>
			</div>

			<div class="col-xs-1">
				O
			</div>
			<div class="col-xs-1">
				C
			</div>
			<div class="col-xs-1">
				BB
			</div>
		</div>
		<div class="jvevents-entrys">
			<f:for each="{paginatedRegistrants}" as="registrant" iteration="iterator">

				<div class="row registrant{registrant.uid} regEvent{registrant.event}">
					<div class="col-xs-1">

						<button type="button" class="btn btn-info btn-sm"  data-toggle="collapse" data-target="#regInfo{registrant.uid}">
							<core:icon identifier="actions-document-info"/>
						</button>


					</div>
					<div class="col-xs-4">
						{registrant.firstName} {registrant.lastName}
					</div>
					<div class="col-xs-4">
						{registrant.email}
					</div>
					<div class="col-xs-1">
						<f:if condition="{registrant.hidden}">
							X
						</f:if>
					</div>

					<div class="col-xs-1">
						<f:if condition="{registrant.hidden}">
							<f:else>
								<f:if condition="{registrant.confirmed}">
									<f:then>
										<f:if condition="{settings.EmConfiguration.enableCitrix}">
											<f:then>
												<f:if condition="{0: registrant.citrixResponse} == {0: '200'} || {0: registrant.citrixResponse} == {0: '201'} ">
													<f:then>
														<f:if condition="{0: registrant.citrixResponse} == {0: '200'}">
															<f:then>
																<span title="Sent to Citrix. Response was OK">
																	{registrant.citrixResponse}
																</span>
															</f:then>
															<f:else>
																<span title="Was ReSent to Citrix. Response was OK">
																	{registrant.citrixResponse}
																</span>
															</f:else>
														</f:if>
													</f:then>
													<f:else>
														<f:link.action absolute="true" class="btn btn-sm tx_jvevents_citrix" action="resendCitrix" arguments="{registrant: registrant.uid}" title="Send to citrix - {registrant.citrixResponse} ">
															<core:icon identifier="actions-system-backend-user-switch"/>
														</f:link.action>
													</f:else>
												</f:if>
											</f:then>
											<f:else>
												ok
											</f:else>
										</f:if>

									</f:then>
									<f:else>
										<f:link.action class="btn btn-sm" action="confirm" arguments="{registrant: registrant, eventID: event}" title="Send Email confirmation">
											<core:icon identifier="actions-document"/>
										</f:link.action>
									</f:else>
								</f:if>
							</f:else>

						</f:if>

					</div>
					<div class="col-xs-1">
						<f:if condition="{registrant.otherEvents}">
	BB
						</f:if>
					</div>

				</div>

				<div id="regInfo{registrant.uid}" class="collapse" role="dialog">
					<div class="well">
						<p>
							Registriert am: <f:format.date format="d.m.Y">{registrant.crdate}</f:format.date><br>
							Firma: {registrant.company}<br>
							Ort: {registrant.zip} {registrant.city}<br>
							Tel: {registrant.phone}<br>
							Info: <f:format.nl2br>{registrant.additionalInfo}</f:format.nl2br><br>

							<f:if condition="{registrant.otherEvents}">
								Blockbucher
							</f:if>
						</p>
					</div>
				</div>

			</f:for>
		</div>
	</f:be.widget.paginate>


</f:section>