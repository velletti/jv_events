{namespace jve=JVE\JvEvents\ViewHelpers}
<f:variable name="tagnames"></f:variable>
<f:variable name="tagids"></f:variable>
<f:variable name="catids"></f:variable>
<f:if condition="{location.Tags}">

    <f:for each="{location.Tags}" as="Tag" iteration="iteration">
        <f:variable name="tagids">{Tag.uid},{tagids}</f:variable>
        <f:variable name="tagnames">{Tag.name}, {tagnames}</f:variable>
    </f:for>
</f:if>
<f:if condition="{location.locationCategory}">
    <f:for each="{location.locationCategory}" as="locationCategory" iteration="iteration">
        <f:variable name="catids">{locationCategory.uid},{catids}</f:variable>
        <f:variable name="catnames">{locationCategory.title}, {catnames}</f:variable>
    </f:for>
</f:if>

<f:spaceless>
    <div class="jv-events-singleLocation jv-events-row" data-locationuid="{location.uid}" data-orguid="{location.organizer.uid}" data-taguids="{tagids}" data-catuids="{catids}" {f:if(condition: '{showDetails}', then: ' id="jv-events-details"' )} >

        <div class="card col-12 my-4 clearfix rounded-bottom">
            <div class="row">
                <div class="col-4  order-1 col-md-3 px-0">

                    <f:link.action action="show" arguments="{location : location.uid}">
                            <f:if condition="{location.teaserImage}">
                                <f:then>
                                    <f:image src="{location.teaserImage.uid}" class="d-block w-100 h-auto img-float rounded shadow-lg" alt="{location.teaserImage.alternative}" title="{location.teaserImage.title}" width="{settings.list.image.width}c" maxWidth="{settings.list.image.width}" maxHeight="{settings.list.image.height}" treatIdAsReference="true" />
                                </f:then>
                                <f:else>
                                    <f:if condition="{location.organizer.teaserImage}">
                                        <f:then>
                                            <f:image src="{location.organizer.teaserImage.uid}" class="d-block w-100 h-auto img-float rounded shadow-lg" alt="{location.organizer.teaserImage.alternative}" title="{location.organizer.teaserImage.title}" width="{settings.list.image.width}c" maxWidth="{settings.list.image.width}" maxHeight="{settings.list.image.height}" treatIdAsReference="true" />
                                        </f:then>
                                        <f:else>
                                            <f:image src="{settings.list.image.defaultImage}" class="d-block w-100 h-auto img-float rounded shadow-lg" alt="img" title="Settings: {settings.list.image.defaultImage}" width="{settings.list.image.width}c" maxWidth="{settings.list.image.width}" maxHeight="{settings.list.image.height}" treatIdAsReference="false" />

                                        </f:else>
                                    </f:if>
                                </f:else>
                            </f:if>
                    </f:link.action>
                </div>

                <div class="col-12 col-md-6  order-3 order-md-2 py-2">
                    <div class="card-block">
                        <h4 class="card-title pb-0 mb-0"><f:link.action  action="show" arguments="{location : location.uid}" >
                            {location.name}
                        </f:link.action></h4>
                        <b>{location.organizer.name}</b><br><br>
                        <f:format.crop maxCharacters="400" append=" &nbsp; ... ">
                            <f:format.stripTags>
                                {location.description}
                            </f:format.stripTags>
                        </f:format.crop>
                    </div>
                </div>

                <div class="col-8 col-md-3 text-black-50 bg-gradient-light  order-2 order-md-3 py-3">
                    <div class="small">
                        <f:if condition="{location.email}">
                            <f:then>
                                <span class="fa fa-envelope mh-sm"></span> <f:link.email email="{location.email}">{location.email}</f:link.email><br>
                            </f:then>
                            <f:else>
                                <f:if condition="{location.organizer.email}">
                                    <f:then>
                                        <span class="fa fa-envelope mh-sm"></span> <f:link.external uri="{location.organizer.email}">{location.organizer.email}</f:link.external><br>
                                    </f:then>
                                </f:if>
                            </f:else>

                        </f:if>
                        <f:if condition="{location.phone}">
                            <f:then>
                                <span class="fa fa-phone mh-sm"></span> <f:link.external uri="{location.phone}" defaultScheme="tel">{location.phone}</f:link.external><br>
                            </f:then>
                            <f:else>
                                <f:if condition="{location.organizer.phone}">
                                    <f:then>
                                        <span class="fa fa-phone mh-sm"></span> <f:link.external uri="{location.organizer.phone}" defaultScheme="tel">{location.organizer.phone}</f:link.external><br>
                                    </f:then>
                                </f:if>
                            </f:else>
                        </f:if>
                        <f:if condition="{location.link}">
                            <f:then>
                                <span class="fa fa-link mh-sm"></span> <f:link.external uri="{location.link}" >{location.link}</f:link.external>
                            </f:then>
                            <f:else>
                                <f:if condition="{location.organizer.link}">
                                    <f:then>
                                        <span class="fa fa-link mh-sm"></span> <f:link.external uri="{location.organizer.link}" >{location.organizer.link}</f:link.external>
                                    </f:then>
                                </f:if>
                            </f:else>
                        </f:if>
                        <br>
                        <span class="d-none d-md-inline-block"> <span class="fa fa-info-circle mh-sm"></span>  {catnames}</span>
                    </div>


                    <div class="text-right position-bottom position-right">
                        <f:if condition="{showEditButton}">
                            <f:link.action class="badge badge-primary m-2 py-2" pageUid="{settings.pageIds.editLocation}" action="edit" controller="Location" arguments="{location: location.uid}">
                                <span class="fas fa-users-cog"> </span> <span class="d-none d-sm-inline-block">{f:translate(key: 'edit', default: 'Edit')} {f:translate(key: 'tx_jvevents_domain_model_location', default: 'Location')} </span>
                            </f:link.action>
                        </f:if>

                        <f:if condition="{settings.HideEventListLink} ">
                            <f:then>
                                <f:if condition="{location.tstamp} > 0 ">
                                    <div class="d-none d-sm-block text-right">
                                        <small>
                                            <span class="fa fa-edit mh-sm"></span> <f:format.date format="d.m.Y">{location.tstamp}</f:format.date><br>
                                        </small>
                                    </div>
                                </f:if>
                            </f:then>
                            <f:else>
                                <f:if condition="{location.latestEvent -> f:format.date(format: 'Y-m-d')} > {f:format.date(date: 'now' , format: 'Y-m-d')}">
                                    <f:link.page class="badge badge-primary m-2 py-2" pageUid="{settings.pageIds.eventList}" additionalParams="{tx_jvevents_events: {overruleFilter: {location: '{location.uid}', category : 'true' , maxDays: 90}}}">
                                        <span class="fas fa-calendar-alt mx-1"></span> <span class="d-none d-sm-inline-block">{f:translate(key: 'LLL:EXT:jv_events/Resources/Private/Language/locallang_be.xlf:flexforms.EventListView', default: 'Termine')} >></span>
                                    </f:link.page>
                                </f:if>
                            </f:else>
                        </f:if>


                    </div>
                </div>
                <f:if condition="{showDetails}">
                    <div class="col-12 order-4 py-2 bg-gradient-light ">
                        <f:format.html>{location.description}</f:format.html>

                    </div>
                </f:if>

            </div>
        </div>
    </div>
</f:spaceless>
