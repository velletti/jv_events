{namespace JVE=JVelletti\JvEvents\ViewHelpers}

<f:if condition="{NoGoogleApiKeyDefined}">
	<strong style="color:red;">No Google Api Key in extension configuration defined!</strong>
</f:if>

<div id="map" style="height:500px;"  data-publicpath="{core:normalizedUrl(pathOrUrl: 'EXT:jv_events/Resources/Public/')}"></div>


<script type="text/javascript" src="{core:normalizedUrl(pathOrUrl: 'EXT:jv_events/Resources/Public/')}JavaScript/googleMapsAllplan.js"></script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key={settings.EmConfiguration.googleApiKey}&callback=initMap&loading=async&libraries=marker"></script>
<script type="text/javascript">

	var addresses = [];

	<f:for each="{addresses}" as="address">
		<f:if condition="{0: address.longitude, 1: address.latitude}">
			var currentAddress = [];
			currentAddress['uid'] = '<JVE:CleanJsString>{address.uid}</JVE:CleanJsString>';
			currentAddress['address'] = '<JVE:CleanJsString>{address.country.shortNameEn}, {address.zip} {address.city}, {address.street_and_nr}</JVE:CleanJsString>';
			currentAddress['title'] = '<JVE:CleanJsString>{address.company}</JVE:CleanJsString>';
			currentAddress['markerText'] = '<JVE:CleanJsString><h3>{address.name}</h3><p>{address.streetAndNr}<br>{address.zip} {address.city}<br>{address.country.shortNameEn}</p></JVE:CleanJsString>';
			currentAddress['lng'] = {address.lng};
			currentAddress['lat'] = {address.lat};
			addresses.push(currentAddress);
		</f:if>
	</f:for>

</script>
